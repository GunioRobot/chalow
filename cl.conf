# -*- perl -*-
### ユーザ設定項目 ###

# --------------------------------------------------------------------
# 日記の名前
$changelog_name = "ChangeLog";

# --------------------------------------------------------------------
# 自分のホームーページのURL、呼び名
$home_page_url = "http://nais.to/~yto/tools/chalow/";
$home_page_name = "chalow home page";

# --------------------------------------------------------------------
# ChangeLog を公開する URL (絶体 URL を強く推奨) - RSS に必要
# 例: $clog_url = "http://nais.to/~yto/clog/";
$clog_url = ".";		# 必ず URL を設定して下さい

# --------------------------------------------------------------------
# インデックスページ (index.html) で最近何日分を表示するか
# (コマンドラインオプション "-n" でも指定できます)
$opt_topn = 7;

# --------------------------------------------------------------------
my $side_menu = << "__SIDE_MENU__"
<table>
<tr><td>カテゴリ</tr>
<tr><td><script language="JavaScript" src="cl-cat.js"></script></td></tr>
<tr><td>最近の話題</tr>
<tr><td><script language="JavaScript" src="cl.js"></script></td></tr>
</table>
__SIDE_MENU__
    ;

# --------------------------------------------------------------------
# カテゴリページのテンプレート
$cat_page_template = << "___CAT_PAGE_TEMPLATE"
<a href="index.html">最新</a> / <a href="$home_page_url">$home_page_name</a>
<h1>カテゴリ[CATEGORYNAME] - $changelog_name</h1>
<div id="content">
CATEGORYCONT
</div>
<div id="links">$side_menu</div> <!-- サイドメニューです -->
<br clear="all" />
<a href="index.html">最新</a> / <a href="$home_page_url">$home_page_name</a>
___CAT_PAGE_TEMPLATE
    ;

# --------------------------------------------------------------------
# インデックスページのテンプレート
$index_page_template = << "___INDEX_PAGE_TEMPLATE"
<p class="adminmenu"><a href="$home_page_url">$home_page_name</a></p>
<p class="adminmenu">最終更新時刻: CLLASTUPDATE</p>
<p class="adminmenu"><a href="cl.rdf">RSS</a></p>
<h1>$changelog_name</h1>
<p class="calendar">MONTHPAGELIST</p> <!-- 月ページのリストが表示されます -->
<div id="content">
LATESTDAYS                 <!-- 最近の NDAYS 日分の日記内容が表示されます -->
</div>
<div id="links">$side_menu</div> <!-- サイドメニューです -->
<br clear="all" />
<p>以上、最近 NDAYS 日分</p>
<p class="calendar">MONTHPAGELIST</p> <!-- 月ページのリストが表示されます -->
<p class="adminmenu"><a href="$home_page_url">$home_page_name</a></p>
___INDEX_PAGE_TEMPLATE
    ;
#	- インデックスページ用内部置き換え文字列:
#	  MONTHPAGELIST: 月別一覧
#	  LATESTDAYS: 最近 N 日分のエントリ
#	  NDAYS: 「最近 N 日分」の N
#	  CLLASTUPDATE: 最終更新時間

# --------------------------------------------------------------------
# 月ページのテンプレート
$month_page_template = << "___MONTH_PAGE_TEMPLATE"
<p class="adminmenu">CLNAVI <a href="index.html">最新</a>
 / <a href="$home_page_url">$home_page_name</a></p>
<h1>$changelog_name YEARMONTH</h1>
<p class="calendar">MONTHPAGELIST</p> <!-- 月ページのリストが表示されます -->
<p class="calendar">DAYLIST</p>    <!-- 日付のリストが表示されます -->
<div id="content">
DAYSINTHEMONTH                         <!-- 日記内容が表示されます -->
</div>
<div id="links">$side_menu</div> <!-- サイドメニューです -->
<br clear="all" />
<p class="calendar">DAYLIST</p>
<p class="calendar">MONTHPAGELIST</p> <!-- 月ページのリストが表示されます -->
<p class="adminmenu">CLNAVI <a href="index.html">最新</a>
 / <a href="$home_page_url">$home_page_name</a></p>
___MONTH_PAGE_TEMPLATE
    ;
#	- 月ページ用内部置き換え文字列:
#	  CLLASTUPDATE: 最終更新時間
#	  CLNAVI: 先月来月ページへのリンク
#	  YEARMONTH: YYYY-MM
#	  DAYLIST: 日付リスト
#	  DAYSINTHEMONTH: その月の全エントリ
#	  MONTHPAGELIST: 月別一覧


# --------------------------------------------------------------------
# 日ごとにページを作るか (0:NO, 1:YES, 2:月ページはヘッダのみ)
$day_page_mode = 0;

# --------------------------------------------------------------------
# 日ページのテンプレート
$day_page_template = << "___DAY_PAGE_TEMPLATE"
CLNAVI <a href="index.html">最新</a>
 / <a href="YEARMONTH.html">今月の一覧</a>
 / <a href="$home_page_url">$home_page_name</a>
<h1>$changelog_name YEARMONTHDAY</h1>
<p class="calendar"><a href="YEARMONTH.html">YEARMONTH</a> / DAYLIST</p>
<div id="content">
DAYSINTHEMONTH                         <!-- 日記内容が表示されます -->
</div>
<div id="links">$side_menu</div> <!-- サイドメニューです -->
<br clear="all" />
<p class="calendar"><a href="YEARMONTH.html">YEARMONTH</a> / DAYLIST</p>
<p class="calendar">MONTHPAGELIST</p>
CLNAVI <a href="index.html">最新</a>
 / <a href="YEARMONTH.html">今月の一覧</a>
 / <a href="$home_page_url">$home_page_name</a>
___DAY_PAGE_TEMPLATE
    ;

# --------------------------------------------------------------------
# インデックスページの HTML ヘッダに追加したいもの (favicon.ico など)
$index_page_head_plus = "";

# --------------------------------------------------------------------
# 月ページの HTML ヘッダに追加したいもの
$month_page_head_plus = "";

# --------------------------------------------------------------------
# 日ページの HTML ヘッダに追加したいもの
$day_page_head_plus = "";

# --------------------------------------------------------------------
# 自動文字列置換
$auto_replace = '
s!(\s)(chalow)(\s)!$1<a href="http://nais.to/~yto/tools/chalow/">$2</a>$3!g;
';

# --------------------------------------------------------------------
# CSS ファイル
$css_file = "diary.css";

# --------------------------------------------------------------------
# 日付の後に曜日(Mon, Tue, ...)を表示するか (1:yes or 0:no)
$show_day_of_week = 1;

# --------------------------------------------------------------------
# 月ページで、日付を降順 (新しい日付が上) で表示するか (1:yes or 0:no)
$reverse_order_days = 1;

# --------------------------------------------------------------------
# タブによるインデントをなくすか (1:なくす or 0:そのまま)
$no_indent = 1;

# --------------------------------------------------------------------
# アイテムヘッダーのフォーマットをどうするか
# (0:"* HOGE:", 1:"* HOGE", 2:"HOGE:",3:"HOGE")
$item_header_style = 1;

# --------------------------------------------------------------------
# 表示するとき引用記号 ('>' or '|') を消すか (1:YES, 0:NO)
$remove_quote_mark = 1;

# --------------------------------------------------------------------
# item header に h3 タグを足すか (1:YES, 0:NO) - tDiary との互換性のため
$use_h3_for_item_header = 0;

# --------------------------------------------------------------------
# item header の先頭の記号にアンカーをつけるか (1:YES, 0:NO)
$use_item_anchor = 1;

# --------------------------------------------------------------------
# item header の先頭の記号の指定
# 『日記のセクションの先頭(サブタイトルの行頭)に挿入される、リンク用の
# アンカー文字列を指定します。なお「<span class="panchor">_</span>」を
# 指定すると、テーマによっては自動的に画像アンカーがつくようになりま
# す。』(tDiary の skel/conf.rhtml より)
$item_header_mark = qq(<span class="sanchor">*</span>);

# --------------------------------------------------------------------
# ツッコミ機能を使用するか (1:YES, 0:NO)
$use_tukkomi = 0;

# --------------------------------------------------------------------
# ツッコミのテンプレート = <div class="comment">...</div> の中味。
# TUKKOMI_DATE はそのエントリの日付 (例: 2003-06-25) に変換される
$tukkomi_template = qq(
<div class="comment">
<div class="caption">
本日のツッコミ [<a href='./kuttukibbs.cgi?url=TUKKOMI_DATE'>全部見る / ツッコミを入れる</a>] | 
<a href="tb/tb.cgi?__mode=list&tb_id=DATE_ID" onclick="window.open(this.href, 'trackback', 'width=480,height=480,scrollbars=yes,status=yes'); return false">TrackBack (<script language="JavaScript" src="tb/tb_data/DATE_ID.js"></script>)</a>
</div>
<script language="JavaScript"  type="text/javascript" src="kblog/TUKKOMI_DATE.js"></script>
</div>
);

# --------------------------------------------------------------------
# RSS を出力するか (1:YES, 0:NO)
$output_rss = 1;

# --------------------------------------------------------------------
# 日記の説明 for RSS : 例: "日々のあれこれ。"
$changelog_description = "";

# --------------------------------------------------------------------
# 他の年の同じ日付 (月日) へのリンクを張るか (1:YES, 0:NO)
$same_date_jump = 1;

# --------------------------------------------------------------------
# 各アイテムに記述者名を表示するか (1:YES, 0:NO)
$show_author_name = 1;

# --------------------------------------------------------------------
# 日付一覧をカレンダー表示にするか (1:YES, 0:NO)
$calendar_style = 0;

# --------------------------------------------------------------------
# 以下、プラグイン

### コメントアウト
# usage: {{com('これは HTML 変換時に削られます')}}
sub com { }

### clsearch キーワード検索 URL 作成
# usage: {{clsearch('海老名 映画館')}}
sub clsearch {
    my ($k) = @_;
    my $o = $k;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    return qq(<a href="clsearch.cgi?key=$k">$o</a>);
}

### google キーワード検索 URL 作成
# usage: {{google_search('海老名 映画館')}}
sub google_search {
    my ($k) = @_;
    my $o = $k;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    my $c = "ie=EUC-JP&oe=EUC-JP&";
    return qq(<a href="http://www.google.co.jp/search?${c}q=$k">$o</a>);
}

### Bulkfeeds キーワード検索
# usage: {{blukfeeds('海老名 映画')}}
sub blukfeeds {
    my ($k) = @_;
    my $o = $k;
    $k = Jcode->new($k)->utf8;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    return qq(<a href="http://bulkfeeds.net/app/search2?q=$k">$o</a>);
}

### Wiki へのリンクの作成
# usage: {{wiki_link('WIKINAME')}}
sub wiki_link {
    my ($k, $o) = @_;
    my $prefix = "http://nais.to/hiki/hiki.cgi?";
    $o = $k if (not defined $o);
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    return qq(<a href="$prefix$k">$o</a>);
}

### 普通の amazon アソシエイトリンクの作成
# usage: {{amazon_link('ASIN', 'ID', 'STR')}}
sub amazon_link {
    my ($asin, $id, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br>/gm;
    $str =~ s/<br>\Z//m;
    return qq(<a href="$prefix/$asin/$id/ref=nosim">$str</a>);
}

### 後ろめたい amazon アソシエイトリンクの作成
# ref. <http://nais.to/~yto/clog/2003-11-06.html#2003-11-06-2>
# usage: {{qualmish_amazon_link('ASIN', 'ID', 'STR')}}
sub qualmish_amazon_link {
    my ($asin, $id, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br>/gm;
    $str =~ s/<br>\Z//m;
    return qq(<a href="$prefix/$asin/$id/ref=nosim" 
	      onMouseOver="window.status='$prefix/$asin'; return true;"
	      onMouseOut="window.status=''; return true;">$str</a>);
}

### URL を短く表示
# usage: {{shorten_url('http://example.com/abc/def/00101033/
# 0123456/aaaaaaaaaaaa/aaaaaaaaaaaa/index.html')}}
sub shorten_url {
    my ($url, $max) = @_;
    $max = 60 if not defined $max;
    $url =~ s/\s+//gsm;
    my $urlstr = $url;
    $urlstr =~ s/^(.{$max}).+$/$1 .../;
    return qq(<a href="$url">$urlstr</a>);
}

### カテゴリページへのリンク
# usage: {{cat('プログラミング')}}
sub cat {
    my ($cn) = @_;
    my $url = get_category_filename($cn);
    return qq(<a href="$url">$cn</a>);
}
